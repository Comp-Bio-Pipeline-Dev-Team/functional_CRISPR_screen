---
title: "test summary report"
date: last-modified
format:
    html: default
    ##pdf: default
editor: 
    render-on-save: true
---

# so you've run a CRISPR functional screen but what does it mean?

this will be some fun text about the crispr functional screen (but they should) already know what's up

# summary stats table

this my attempt at pulling a table in. can read in .tsv/.csv files via R or python (I'm using R here). ive hidden the code chunk so you can only see the output.

```{r}
#| label: tbl-summaryStats
#| tbl-cap: "sample counts per analysis step"
#| tbl-colwidths: [60,40]

library(knitr)
library(readr)

summary_table <- read_tsv('summary_stats/summary_stat_table.tsv', show_col_types = FALSE)

new_cols <- c('Sample ID',
'Total Reads Sequenced',
'Reads with Vector',
'Reads without Vector',
'Reads Aligned to sgRNA',
'Reads Not Aligned to sgRNA',
'Reads with Alignments Suppressed',
'Total sgRNA Represented',
'sgRNA > 10 Reads')

colnames(summary_table) <- new_cols

kable(summary_table, align='lcccccccc')
```

| Column                           | Explanation                                                                                                                                                              |
|--------------------|----------------------------------------------------|
| Total Reads Sequenced            | Total number of reads sequenced in your sample.                                                                                                                          |
| Reads with Vector                | Total number of reads containing the vector sequence. This is the number of reads used for alignment.                                                                    |
| Reads without Vector             | Total number of reads where the vector sequence was not detected and therefore not considered for sgRNA mapping. These reads are not included in the alignment step.     |
| Reads Aligned to sgRNA           | Total number of reads that contained a vector sequence that had a read aligning to a sgRNA at the set mismatch rate of {{< var bowtie_mismatches >}}.                    |
| Reads Not Aligned to sgRNA       | Total number of reads that contained a vector sequence where the vector sequence **did not** align to a sgRNA at the set mismatch rate of {{< var bowtie_mismatches >}}. |
| Reads with Alignments Suppressed | Total number of reads that contained a vector sequence that aligned more than once to a sgRNA. We want to guarantee that all reported alignments to a sgRNA are unique.  |
| Total sgRNA Represented          | The total number of unique guides with at least 1 read count detected. Percentage is based upon fasta of guide library used as the reference.                            |
| sgRNA \> 10 Reads                | The total number of unique guides with at least 10 read counts detected. Percentage is based upon fasta of guide library used as the reference.                          |

: summary table explained {tbl-colwidths="\[25,75\]".striped}

# what we do

(workflow overview)

note: for the workflow .png to render in a non-blurry format you'll need to save it to the exact px dimensions that you want it to be in for the html (so this file). right now it's; w: 2850 px, h: 2311 px, dpi: 688.27.

![](plots/workflow_flowchart.png){width="2850"}

| Workflow Step                            | Why we do this                                                                                                                                                                              |
|-------------------|-----------------------------------------------------|
| 1: Quality Check                         | Done to assess the overall quality of the sequences we received prior to additional analysis.                                                                                               |
| 2: Raw Sequence Prep (trimming)          | To trim all found sequences from the 5' end to 20 base pairs (bp) in length based on the vector sequence of the library that was used. All sgRNA sequences should be about 20 bp in length. |
| 3: Sequence Alignment                    | To map the trimmed sgRNA sequences to the associated library that they were prepped with to see which sgRNA sequences are present.                                                          |
| 4: Counting sgRNA Sequences              | To count how many sgRNA sequences and genes mapped to the sgRNA index for each sample.                                                                                                      |
| 5: Combining sgRNA Count Files           | To combine the sgRNA count data for each sample into one file for downstream R comparison analysis.                                                                                         |
| 6: Normalizing Combined sgRNA Count File | To generate all needed files to perform PCA, total/transformed count, and correlation R analysis. sgRNA and gene count data are normalized to counts per million (CPM).                     |
| 7: PCA Analysis                          | Plotted at the sgRNA and gene level to see if biological replicates cluster together as they should.                                                                                        |
| 8: Total/Transformed Count Comparison    | Plotted at the sgRNA and gene level to ensure that biological replicates have about the same distribution of counts.                                                                        |
| 9: Correlation Comparison                | Plotted at the sgRNA and gene level to ensure that biological group replicates correlate more closely with each other than replicates in a different biological group.                      |

: workflow diagram explained {tbl-colwidths="\[25,75\]".striped}

# plots

this is my attempt at pulling a plot in. update: plots need to be in .png format to render ! saved all plots as a .png as well and put them in `report/plots` for report generation.

## total and transformed counts

here's info on why we looked at total and transformed counts sgRNA guide sequences overall (there isn't a separate one for individual genes since they both add up to the same number).

### total counts

total counts of guide sequences per biological group

![Total Count Plot](plots/sample_totalCount_plot.png)

### transformed counts 

log2() transformed counts of guide sequences per biological group **(why are we doing this??)**

![log2(Total Count Plot)](plots/sample_transCounts_plot.png)

## pca analysis

here's a little info on the pca analysis done and the two outputs! looking at the clustering of biological replicates via principal components analysis. we should expect replicates in the same biological group to cluster together (this is not a good example).

### sgRNA count PCA

we did this using all of the guide RNA sequences

![sgRNA Count PCA plot](plots/sgRNACount_PCA_plot.png)

### gene count PCA

this was done using the individual genes

![Gene Count PCA plot](plots/geneCount_PCA_plot.png)

## correlation analysis

here's info on why we did correlation analysis on the different biological groups! we wanted to make sure that all replicates in a biological group correlate more closely with each other than other biological groups (i.e. we want a correlation value closer to 1). positive correlations will be deeper blue and negative correlations will be deeper red.

### sgRNA correlation comparisons

we did this for all sgRNA sequences

![sgRNA Count Correlation Plot](plots/sgRNACount_correlationMatrix.png)

### gene correlation comparisons

this was done using the individual genes

![Gene Count Correlation Plot](plots/geneCount_correlationMatrix.png)

# contact information

If you have any questions regarding your results, our analysis, or ways to further process your data please feel free to contact us! As always, if we have done any analysis for you that ends up in a publication please consider including us in the author list.

**Madi Apgar, MS: madison.apgar\@cuanschutz.edu**\
**Tonya Brunetti, PhD: tonya.brunetti\@cuanschutz.edu**

This workflow is publically available as a [GitHub repository](https://github.com/Comp-Bio-Pipeline-Dev-Team/functional_CRISPR_screen).